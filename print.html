<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>cargo-nextest</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        <meta name="twitter:card" content="summary_large_image" />
<meta property="og:title" content="cargo-nextest" />
<meta property="og:image" content="https://nexte.st/static/cover.png" />
<meta property="og:description" content="A next-generation test runner for Rust." />

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="A next-generation test runner for Rust.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="css/extra.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Home</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="book/installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/pre-built-binaries.html"><strong aria-hidden="true">1.1.</strong> Pre-built binaries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/release-urls.html"><strong aria-hidden="true">1.1.1.</strong> Release URLs</a></li></ol></li><li class="chapter-item expanded "><a href="book/installing-from-source.html"><strong aria-hidden="true">1.2.</strong> Installing from source</a></li><li class="chapter-item expanded "><a href="book/antivirus-gatekeeper.html"><strong aria-hidden="true">1.3.</strong> Windows antivirus and macOS Gatekeeper</a></li></ol></li><li class="chapter-item expanded "><a href="book/usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/running.html"><strong aria-hidden="true">2.1.</strong> Running tests</a></li><li class="chapter-item expanded "><a href="book/listing.html"><strong aria-hidden="true">2.2.</strong> Listing tests</a></li><li class="chapter-item expanded "><a href="book/retries.html"><strong aria-hidden="true">2.3.</strong> Retries and flaky tests</a></li><li class="chapter-item expanded "><a href="book/partitioning.html"><strong aria-hidden="true">2.4.</strong> Partitioning test runs in CI</a></li><li class="chapter-item expanded "><a href="book/target-runners.html"><strong aria-hidden="true">2.5.</strong> Target runners</a></li><li class="chapter-item expanded "><a href="book/other-options.html"><strong aria-hidden="true">2.6.</strong> Other options</a></li><li class="chapter-item expanded "><a href="book/env-vars.html"><strong aria-hidden="true">2.7.</strong> Environment variables</a></li></ol></li><li class="chapter-item expanded "><a href="book/machine-readable.html"><strong aria-hidden="true">3.</strong> Machine-readable output</a></li><li class="chapter-item expanded "><a href="book/configuration.html"><strong aria-hidden="true">4.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="book/junit.html"><strong aria-hidden="true">5.</strong> JUnit support</a></li><li class="chapter-item expanded "><a href="book/test-coverage.html"><strong aria-hidden="true">6.</strong> Test coverage</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="book/stability.html"><strong aria-hidden="true">7.</strong> Stability policy</a></li><li class="chapter-item expanded "><a href="book/experimental-features.html"><strong aria-hidden="true">8.</strong> Experimental features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/reusing-builds.html"><strong aria-hidden="true">8.1.</strong> Reusing builds</a></li><li class="chapter-item expanded "><a href="book/filtering-expression.html"><strong aria-hidden="true">8.2.</strong> Filtering expression</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="book/how-it-works.html"><strong aria-hidden="true">9.</strong> How nextest works</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="book/benchmarks.html"><strong aria-hidden="true">9.1.</strong> Benchmarks</a></li><li class="chapter-item expanded "><a href="book/custom-test-harnesses.html"><strong aria-hidden="true">9.2.</strong> Custom test harnesses</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="CHANGELOG.html">Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">cargo-nextest</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/nextest-rs/nextest" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cargo-nextest"><a class="header" href="#cargo-nextest">cargo-nextest</a></h1>
<p>Welcome to the home page for <strong>cargo-nextest</strong>, a next-generation test runner for Rust projects.</p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<img src="static/cover.png" id="nextest-cover">
<ul>
<li><strong>Clean, beautiful user interface.</strong> Nextest presents its results concisely so you can see which tests passed and failed at a glance.</li>
<li><strong><a href="book/benchmarks.html">Up to 60% faster</a> than cargo test.</strong> Nextest uses a <a href="book/how-it-works.html">state-of-the-art execution model</a> for faster, more reliable test runs.</li>
<li><strong>Identify slow tests.</strong> Use nextest to detect tests that take a long time to run, and identify bottlenecks during test execution.</li>
<li><strong>Designed for CI.</strong> Nextest addresses real-world pain points with continuous integration scenarios.
<ul>
<li>Use <strong><a href="book/pre-built-binaries.html">pre-built binaries</a></strong> for quick installation.</li>
<li>Set up CI-specific <strong><a href="book/configuration.html">configuration profiles</a></strong>.</li>
<li><strong><a href="book/partitioning.html">Partition test runs</a></strong> across multiple CI jobs.</li>
<li><a href="book/retries.html"><strong>Automatically retry</strong></a> failing tests, and mark them as flaky if they pass later.</li>
<li>Print failing output <strong><a href="book/other-options.html#reporter-options">at the end of test runs</a></strong>.</li>
<li>Output information about test runs as <strong><a href="book/junit.html">JUnit XML</a></strong>.</li>
</ul>
</li>
<li><strong>Cross-platform.</strong> Nextest works on Unix, Mac and Windows, so you get the benefits of faster test runs no matter what platform you use.</li>
<li>... and more <a href="https://github.com/nextest-rs/nextest/projects/1">coming soon</a>!</li>
</ul>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick start</a></h2>
<p>Install cargo-nextest for your platform using the <a href="book/pre-built-binaries.html">pre-built binaries</a>.</p>
<p>Run all tests in a workspace:</p>
<pre><code>cargo nextest run
</code></pre>
<p>For more detailed installation instructions, see <a href="book/installation.html">Installation</a>.</p>
<h2 id="crates-in-this-project"><a class="header" href="#crates-in-this-project">Crates in this project</a></h2>
<table><thead><tr><th>Crate</th><th style="text-align: center">crates.io</th><th style="text-align: center">rustdoc (latest version)</th><th style="text-align: center">rustdoc (main)</th></tr></thead><tbody>
<tr><td><strong>cargo-nextest,</strong> the main test binary</td><td style="text-align: center"><a href="https://crates.io/crates/cargo-nextest"><img src="https://img.shields.io/crates/v/cargo-nextest" alt="cargo-nextest on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/cargo-nextest"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/cargo_nextest"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>nextest-runner,</strong> core nextest logic</td><td style="text-align: center"><a href="https://crates.io/crates/nextest-runner"><img src="https://img.shields.io/crates/v/nextest-runner" alt="nextest-runner on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/nextest-runner"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/nextest_runner"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>nextest-metadata,</strong> parsers for machine-readable output</td><td style="text-align: center"><a href="https://crates.io/crates/nextest-metadata"><img src="https://img.shields.io/crates/v/nextest-metadata" alt="nextest-metadata on crates.io" /></a></td><td style="text-align: center"><a href="https://docs.rs/nextest-metadata"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/nextest_metadata"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
<tr><td><strong>quick-junit,</strong> JUnit XML serializer</td><td style="text-align: center"><a href="https://crates.io/crates/quick-junit"><img src="https://img.shields.io/crates/v/quick-junit" alt="quick-junit on crates.io" /></a></td><td style="text-align: center"><a href="https://crates.io/crates/quick-junit"><img src="https://img.shields.io/badge/docs-latest-brightgreen" alt="Documentation (latest release)" /></a></td><td style="text-align: center"><a href="https://nexte.st/rustdoc/quick_junit"><img src="https://img.shields.io/badge/docs-main-purple" alt="Documentation (main)" /></a></td></tr>
</tbody></table>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>The source code for nextest and this site are hosted on GitHub, at
<a href="https://github.com/nextest-rs/nextest">https://github.com/nextest-rs/nextest</a>.</p>
<p>Contributions are welcome! Please see the <a href="https://github.com/nextest-rs/nextest/blob/main/CONTRIBUTING.md">CONTRIBUTING
file</a> for how to help out.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>The source code for nextest is licensed under the
<a href="https://github.com/nextest-rs/nextest/blob/main/LICENSE-MIT">MIT</a> and <a href="https://github.com/nextest-rs/nextest/blob/main/LICENSE-APACHE">Apache
2.0</a> licenses.</p>
<p>This document is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. This means that you are welcome to share, adapt or
modify this material as long as you give appropriate credit.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-and-usage"><a class="header" href="#installation-and-usage">Installation and usage</a></h1>
<p>cargo-nextest works on Linux and other Unix-like OSes, macOS, and Windows.</p>
<h2 id="installing-pre-built-binaries-recommended"><a class="header" href="#installing-pre-built-binaries-recommended">Installing pre-built binaries (recommended)</a></h2>
<p>cargo-nextest is available as pre-built binaries. See <a href="book/pre-built-binaries.html">Pre-built binaries</a> for more information.</p>
<h2 id="installing-from-source"><a class="header" href="#installing-from-source">Installing from source</a></h2>
<p>If pre-built binaries are not available for your platform, or you'd like to otherwise install cargo-nextest from source, see <a href="book/installing-from-source.html">Installing from source</a> for more information.</p>
<h2 id="windows-antivirus-and-macos-gatekeeper"><a class="header" href="#windows-antivirus-and-macos-gatekeeper">Windows antivirus and macOS Gatekeeper</a></h2>
<p>For notes about platform-specific performance issues caused by anti-malware software on Windows and macOS, see <a href="book/antivirus-gatekeeper.html">Windows antivirus and macOS Gatekeeper</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-pre-built-binaries"><a class="header" href="#installing-pre-built-binaries">Installing pre-built binaries</a></h1>
<p>The quickest way to get going with nextest is to download a pre-built binary for your platform. The latest nextest release is available at:</p>
<ul>
<li><a href="https://get.nexte.st/latest/linux"><strong>get.nexte.st/latest/linux</strong></a> for Linux x86_64, including Windows Subsystem for Linux (WSL)</li>
<li><a href="https://get.nexte.st/latest/mac"><strong>get.nexte.st/latest/mac</strong></a> for macOS, both x86_64 and Apple Silicon</li>
<li><a href="https://get.nexte.st/latest/windows"><strong>get.nexte.st/latest/windows</strong></a> for Windows x86_64</li>
</ul>
<p>These archives contain a single binary called <code>cargo-nextest</code>. Add this binary to a location on your PATH.</p>
<h2 id="downloading-and-installing-from-your-terminal"><a class="header" href="#downloading-and-installing-from-your-terminal">Downloading and installing from your terminal</a></h2>
<p>The instructions below are suitable for both end users and CI. These links will stay stable.</p>
<blockquote>
<p>NOTE: The instructions below assume that your Rust installation is managed via rustup. You can extract the archive to a different directory in your PATH if required.</p>
<p>If you'd like to stay on the 0.9 series to avoid breaking changes (see the <a href="book/stability.html">stability policy</a> for more), replace <code>latest</code> in the URL with <code>0.9</code>.</p>
</blockquote>
<h3 id="linux-x86_64"><a class="header" href="#linux-x86_64">Linux x86_64</a></h3>
<pre><code>curl -LsSf https://get.nexte.st/latest/linux | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<h3 id="macos-x86_64-and-apple-silicon"><a class="header" href="#macos-x86_64-and-apple-silicon">macOS (x86_64 and Apple Silicon)</a></h3>
<pre><code>curl -LsSf https://get.nexte.st/latest/mac | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<p>This will download a universal binary that works on both Intel and Apple Silicon Macs.</p>
<h3 id="windows-x86_64-using-powershell"><a class="header" href="#windows-x86_64-using-powershell">Windows x86_64 using PowerShell</a></h3>
<p>Run this in PowerShell:</p>
<pre><code class="language-powershell">$tmp = New-TemporaryFile | Rename-Item -NewName { $_ -replace 'tmp$', 'zip' } -PassThru
Invoke-WebRequest -OutFile $tmp https://get.nexte.st/latest/windows
$outputDir = if ($Env:CARGO_HOME) { Join-Path $Env:CARGO_HOME &quot;bin&quot; } else { &quot;~/.cargo/bin&quot; }
$tmp | Expand-Archive -DestinationPath $outputDir -Force
$tmp | Remove-Item
</code></pre>
<h3 id="windows-x86_64-using-unix-tools"><a class="header" href="#windows-x86_64-using-unix-tools">Windows x86_64 using Unix tools</a></h3>
<p>If you have access to a Unix shell, <code>curl</code> and <code>tar</code> <em>natively</em> on Windows (for example if you're using <code>shell: bash</code> on GitHub Actions):</p>
<pre><code>curl -LsSf https://get.nexte.st/latest/windows-tar | tar zxf - -C ${CARGO_HOME:-~/.cargo}/bin
</code></pre>
<blockquote>
<p>NOTE: Windows Subsystem for Linux (WSL) users should follow the <a href="book/pre-built-binaries.html#linux-x86_64">Linux x86_64 instructions</a>.</p>
<p>If you're a Windows expert who can come up with a better way to do this, please <a href="https://github.com/nextest-rs/nextest/issues/31">add a suggestion to this issue</a>!</p>
</blockquote>
<h2 id="using-pre-built-binaries-in-ci"><a class="header" href="#using-pre-built-binaries-in-ci">Using pre-built binaries in CI</a></h2>
<p>Pre-built binaries can be used in continuous integration to speed up test runs.</p>
<h3 id="using-nextest-in-github-actions"><a class="header" href="#using-nextest-in-github-actions">Using nextest in GitHub Actions</a></h3>
<p>The easiest way to install nextest in GitHub Actions is to use the <a href="https://github.com/marketplace/actions/install-development-tools">Install Development Tools</a> action maintained by <a href="https://github.com/taiki-e">Taiki Endo</a>.</p>
<p>To install the latest version of nextest, add this to your job after installing Rust and Cargo:</p>
<pre><code class="language-yml">- uses: taiki-e/install-action@nextest
</code></pre>
<p><a href="https://github.com/nextest-rs/nextest/blob/5b59a5c5d1a051ce651e5d632c93a849f97a9d4b/.github/workflows/ci.yml#L101-L102">See this in practice with nextest's own CI.</a></p>
<p>The action will download pre-built binaries from the URL above and add them to <code>.cargo/bin</code>.</p>
<p>To install a version series or specific version, use this instead:</p>
<pre><code class="language-yml">- uses: taiki-e/install-action@v1
- with:
    tool: nextest
    ## version (defaults to &quot;latest&quot;) can be a series like 0.9:
    # version: 0.9
    ## version can also be a specific version like 0.9.11:
    # version: 0.9.11
</code></pre>
<h3 id="other-ci-systems"><a class="header" href="#other-ci-systems">Other CI systems</a></h3>
<p>Install pre-built binaries on other CI systems by downloading and extracting the respective archives, using the commands above as a guide. See <a href="book/release-urls.html">Release URLs</a> for more about how to specify nextest versions and platforms.</p>
<blockquote>
<p>If you've made it easy to install nextest on another CI system, feel free to <a href="https://github.com/nextest-rs/nextest/pulls">submit a pull request</a> with documentation.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-urls"><a class="header" href="#release-urls">Release URLs</a></h1>
<p>Binary releases of cargo-nextest will always be available at <strong><code>https://get.nexte.st/{version}/{platform}</code></strong>.</p>
<h2 id="version-identifier"><a class="header" href="#version-identifier"><code>{version}</code> identifier</a></h2>
<p>The <code>{version}</code> identifier is:</p>
<ul>
<li><code>latest</code> for the latest release (not including pre-releases)</li>
<li>a version range, for example <code>0.9</code>, for the latest release in the 0.9 series (not including pre-releases)</li>
<li>the exact version number, for example <code>0.9.4</code>, for that specific version</li>
</ul>
<h2 id="platform-identifier"><a class="header" href="#platform-identifier"><code>{platform}</code> identifier</a></h2>
<p>The <code>{platform}</code> identifier is:</p>
<ul>
<li><code>x86_64-unknown-linux-gnu.tar.gz</code> for x86_64 Linux (tar.gz)</li>
<li><code>universal-apple-darwin.tar.gz</code> for x86_64 and arm64 macOS (tar.gz)</li>
<li><code>x86_64-pc-windows-msvc.zip</code> for x86_64 Windows (zip)</li>
<li><code>x86_64-pc-windows-msvc.tar.gz</code> for x86_64 Windows (tar.gz)</li>
</ul>
<p>For convenience, the following shortcuts are defined:</p>
<ul>
<li><code>linux</code> points to <code>x86_64-unknown-linux-gnu.tar.gz</code></li>
<li><code>mac</code> points to <code>universal-apple-darwin.tar.gz</code></li>
<li><code>windows</code> points to <code>x86_64-pc-windows-msvc.zip</code></li>
<li><code>windows-tar</code> points to <code>x86_64-pc-windows-msvc.tar.gz</code></li>
</ul>
<p>Also, each release's canonical GitHub Releases URL is available at <strong><code>https://get.nexte.st/{version}/release</code></strong>. For example, the latest GitHub release is avaiable at <a href="https://get.nexte.st/latest/release">get.nexte.st/latest/release</a>.</p>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<p>The latest nextest release in the 0.9 series for macOS is available as a tar.gz file at <a href="https://get.nexte.st/0.9/mac">get.nexte.st/0.9/mac</a>.</p>
<p>Nextest version 0.9.11 for Windows is available as a zip file at <a href="https://get.nexte.st/0.9.11/windows">get.nexte.st/0.9.11/windows</a>, and as a tar.gz file at <a href="https://get.nexte.st/0.9.11/windows-tar">get.nexte.st/0.9.11/windows-tar</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-from-source-1"><a class="header" href="#installing-from-source-1">Installing from source</a></h1>
<p>If pre-built binaries are not available for your platform, or you'd otherwise like to install cargo-nextest from source, here's what you need to do:</p>
<h2 id="installing-from-cratesio"><a class="header" href="#installing-from-cratesio">Installing from crates.io</a></h2>
<p>Run the following command:</p>
<pre><code>cargo install cargo-nextest
</code></pre>
<p><code>cargo nextest</code> must be compiled and installed with <strong>Rust 1.56</strong> or later (see <a href="book/stability.html#minimum-supported-rust-version-msrv">Stability policy</a> for more), but it can build and run
tests against any version of Rust.</p>
<h2 id="using-a-cached-install-in-ci"><a class="header" href="#using-a-cached-install-in-ci">Using a cached install in CI</a></h2>
<p>Most CI users of nextest will benefit from using cached binaries. Consider using the <a href="book/pre-built-binaries.html">pre-built binaries</a> for this purpose.</p>
<p><a href="https://github.com/nextest-rs/nextest/blob/e43ac449f53fd34e58136cd94b7a72add201fe5a/.github/workflows/ci.yml#L104-L107">See this example for how the nextest repository uses pre-built binaries.</a></p>
<p>If your CI is based on GitHub Actions, you may use the
<a href="https://github.com/marketplace/actions/cargo-install">baptiste0928/cargo-install</a> action to build cargo-nextest from source and cache
the cargo-nextest binary.</p>
<pre><code class="language-yml">jobs:
  ci:
    # ...
    steps:
      - uses: actions/checkout@v2
      # Install a Rust toolchain here.
      - name: Install cargo-nextest
        uses: baptiste0928/cargo-install@v1
        with:
          crate: cargo-nextest
          # Uncomment the following line if you'd like to stay on the 0.9 series
          # version: 0.9
      # At this point, cargo-nextest will be available on your PATH
</code></pre>
<p>Also consider using the <a href="https://github.com/marketplace/actions/rust-cache">Swatinem/rust-cache</a>
action to make your builds faster.</p>
<h2 id="installing-from-github"><a class="header" href="#installing-from-github">Installing from GitHub</a></h2>
<p>Install the latest, in-development version of cargo-nextest from the GitHub repository:</p>
<pre><code>cargo install --git https://github.com/nextest-rs/nextest --bin cargo-nextest
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="windows-antivirus-and-macos-gatekeeper-1"><a class="header" href="#windows-antivirus-and-macos-gatekeeper-1">Windows antivirus and macOS Gatekeeper</a></h1>
<p>This page covers common performance issues caused by anti-malware protections on Windows and macOS. These performance issues are not unique to nextest, but <a href="book/how-it-works.html">its execution model</a> may exacerbate them.</p>
<blockquote>
<p>NOTE: If you'd like to contribute screenshots, they would be greatly appreciated!</p>
</blockquote>
<h2 id="windows"><a class="header" href="#windows">Windows</a></h2>
<p>Your antivirus software—typically Windows Security, also known as Microsoft Defender—might interfere with process execution, making your test runs significantly slower. For optimal performance, exclude the following directories from checks:</p>
<ul>
<li>The directory with all your code in it</li>
<li>Your <code>.cargo\bin</code> directory, typically within your home directory (see <a href="https://github.com/rust-lang/cargo/issues/5028">this Rust issue</a>).</li>
</ul>
<p><a href="https://support.microsoft.com/en-us/windows/add-an-exclusion-to-windows-security-811816c0-4dfd-af4a-47e4-c301afe13b26">Here's how to exclude directories from Windows Security.</a></p>
<h2 id="macos"><a class="header" href="#macos">macOS</a></h2>
<p>Similar to Windows Security, macOS has a system called Gatekeeper which performs checks on binaries. Gatekeeper can cause nextest runs to be significantly slower. A typical sign of this happening is even the simplest of tests in <code>cargo nextest run</code> taking more than 0.2 seconds.</p>
<p>Adding your terminal to Developer Tools will cause any processes run by it to be excluded from Gatekeeper. <strong>For optimal performance, add your terminal to Developer Tools.</strong> You may also need to run <code>cargo clean</code> afterwards.</p>
<h3 id="how-to-add-your-terminal-to-developer-tools"><a class="header" href="#how-to-add-your-terminal-to-developer-tools">How to add your terminal to Developer Tools</a></h3>
<ol>
<li>Run <code>sudo spctl developer-mode enable-terminal</code> in your terminal.</li>
<li>Go to System Preferences, and then to Security &amp; Privacy.</li>
<li>Under the Privacy tab, an item called <code>Developer Tools</code> should be present. Navigate to it.</li>
<li>Ensure that your terminal is listed and enabled. If you're using a third-party terminal like iTerm, be sure to add it to the list.</li>
<li>Restart your terminal.</li>
</ol>
<p><a href="https://news.ycombinator.com/item?id=24394150">See this comment on Hacker News for more.</a></p>
<blockquote>
<p>There are still some reports of performance issues on macOS after Developer Tools have been enabled. If you're seeing this, please <a href="https://github.com/nextest-rs/nextest/issues/63">add a note to this issue</a>!</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>This section covers usage, features and options for cargo-nextest.</p>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic usage</a></h2>
<p>To build and run all tests in a workspace, cd into the workspace and run:</p>
<pre><code>cargo nextest run
</code></pre>
<p>For more information about running tests, see <a href="book/running.html">Running tests</a>.</p>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<ul>
<li>
<p>The <a href="book/how-it-works.html">nextest execution model</a> means that <strong>each individual test is executed as a separate process</strong>. Tests that depend on being executed within the same process <a href="https://github.com/nextest-rs/nextest/issues/27">may not work correctly</a>.</p>
<p>To work around this, consider combining those tests into one so that nextest runs them as a
unit, or excluding those tests from nextest.</p>
</li>
<li>
<p>There's <a href="https://github.com/nextest-rs/nextest/issues/28">no way</a> to mark a particular test binary as excluded from nextest.</p>
</li>
<li>
<p>The <code>--skip</code> and <code>--exact</code> test filter options are currently <a href="https://github.com/nextest-rs/nextest/issues/29">not supported</a> by nextest.</p>
</li>
<li>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust. Locally and in CI, after <code>cargo nextest run</code>, use <code>cargo test --doc</code> to run all doctests.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-tests"><a class="header" href="#running-tests">Running tests</a></h1>
<p>To build and run all tests in a workspace<sup class="footnote-reference"><a href="#doctest">1</a></sup>, cd into the workspace and run:</p>
<pre><code>cargo nextest run
</code></pre>
<p>This will produce output that looks like:</p>
<p><img src="book/../static/nextest-run.png" alt="Output of cargo nextest run" /></p>
<p>In the output above:</p>
<ul>
<li>
<p>Tests are marked <strong><code>PASS</code></strong> or <strong><code>FAIL</code></strong>, and the amount of wall-clock time each test takes is listed within square brackets. In the example above, <strong><code>test_list_tests</code></strong> passed and took 0.603 seconds to execute.</p>
</li>
<li>
<p>Tests that take more than a specified amount of time are marked <strong>SLOW</strong>. The timeout is 60 seconds by default, and can be <a href="book/configuration.html">changed through configuration</a>.</p>
</li>
<li>
<p>The part of the test in purple is the <em>test binary</em>. A test binary is either:</p>
<ul>
<li>a <em>unit test binary</em> built from tests inline within <code>lib.rs</code>. These test binaries are shown by nextest as just the crate name, without a <code>::</code> separator inside them.</li>
<li>an <em>integration test binary</em> built from tests in the <code>[[test]]</code> section of <code>Cargo.toml</code> (typically tests in the <code>tests</code> directory.) These tests are shown by nextest in the format <code>crate-name::bin-name</code><sup class="footnote-reference"><a href="#bin-example">2</a></sup>.</li>
</ul>
<p>For more about unit and integration tests, see <a href="https://doc.rust-lang.org/cargo/commands/cargo-test.html">the documentation for <code>cargo test</code></a>.</p>
</li>
<li>
<p>The part after the test binary is the <em>test name</em>, including the module the test is in. The final part of the test name is highlighted in bold blue text.</p>
</li>
</ul>
<p><code>cargo nextest run</code> supports all the options that <code>cargo test</code> does. For example, to only execute tests for a package called <code>my-package</code>:</p>
<pre><code>cargo nextest run -p my-package
</code></pre>
<p>For a full list of options accepted by <code>cargo nextest run</code>, see <code>cargo nextest run --help</code>.</p>
<div class="footnote-definition" id="bin-example"><sup class="footnote-definition-label">2</sup>
<p><code>bin</code> and <code>example</code> targets can also contain tests. Those are represented as <code>crate-name::bin/bin-name</code> and <code>crate-name::example/example-name</code>, respectively.</p>
</div>
<h2 id="filtering-tests"><a class="header" href="#filtering-tests">Filtering tests</a></h2>
<p>To only run tests that match certain names:</p>
<pre><code>cargo nextest run &lt;test-name1&gt; &lt;test-name2&gt;...
</code></pre>
<p>This is different from <code>cargo test</code>, where you have to specify a <code>--</code>, for example: <code>cargo test -- &lt;test-name1&gt; &lt;test-name2&gt;...</code>.</p>
<h3 id="filtering-by-build-platform"><a class="header" href="#filtering-by-build-platform">Filtering by build platform</a></h3>
<p>While cross-compiling code, some tests (e.g. proc-macro tests) may need to be run on the host platform. To filter tests based on the build platform they're for, nextest accepts the <code>--platform-filter</code> option with values <code>target</code>, <code>host</code> or <code>any</code> (default).</p>
<p>For example, to only run tests for the host platform:</p>
<pre><code>cargo nextest run --platform-filter host
</code></pre>
<h2 id="displaying-live-test-output"><a class="header" href="#displaying-live-test-output">Displaying live test output</a></h2>
<p>By default, <code>cargo nextest run</code> will capture test output and only display it on failure. If you do <em>not</em> want to capture test output:</p>
<pre><code>cargo nextest run --no-capture
</code></pre>
<p>In this mode, cargo-nextest will run tests <em>serially</em> so that output from different tests isn't interspersed. This is different from <code>cargo test -- --nocapture</code>, which will run tests in parallel.</p>
<div class="footnote-definition" id="doctest"><sup class="footnote-definition-label">1</sup>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust.</p>
</div>
<h2 id="options-and-arguments"><a class="header" href="#options-and-arguments">Options and arguments</a></h2>
<pre><code>cargo-nextest-run 
Build and run tests

USAGE:
    cargo nextest run [OPTIONS] [FILTERS]...

ARGS:
    &lt;FILTERS&gt;...    Test name filter

OPTIONS:
        --manifest-path &lt;PATH&gt;    Path to Cargo.toml
    -P, --profile &lt;PROFILE&gt;       Nextest profile to use [env: NEXTEST_PROFILE=]
    -v, --verbose                 Verbose output [env: NEXTEST_VERBOSE=]
        --color &lt;WHEN&gt;            Produce color output: auto, always, never [env: CARGO_TERM_COLOR=]
                                  [default: auto]
        --config-file &lt;PATH&gt;      Config file [default: workspace-root/.config/nextest.toml]
    -h, --help                    Print help information

RUNNER OPTIONS:
    -j, --test-threads &lt;THREADS&gt;    Number of tests to run simultaneously [default: logical CPU
                                    count] [env: NEXTEST_TEST_THREADS=] [aliases: jobs]
        --retries &lt;RETRIES&gt;         Number of retries for failing tests [default: from profile]
        --fail-fast                 Cancel test run on the first failure
        --no-fail-fast              Run all tests regardless of failure
        --no-capture                Run tests serially and do not capture output

CARGO OPTIONS:
        --lib                       Test only this package's library unit tests
        --bin &lt;BIN&gt;                 Test only the specified binary
        --bins                      Test all binaries
        --test &lt;TEST&gt;               Test only the specified test target
        --tests                     Test all targets
        --bench &lt;BENCH&gt;             Test only the specified bench target
        --benches                   Test all benches
        --all-targets               Test all targets
    -p, --package &lt;PACKAGES&gt;        Package to test
        --workspace                 Build all packages in the workspace
        --exclude &lt;EXCLUDE&gt;         Exclude packages from the test
        --all                       Alias for workspace (deprecated)
    -r, --release                   Build artifacts in release mode, with optimizations
        --cargo-profile &lt;NAME&gt;      Build artifacts with the specified Cargo profile
        --build-jobs &lt;JOBS&gt;         Number of build jobs to run
        --features &lt;FEATURES&gt;       Space or comma separated list of features to activate
        --all-features              Activate all available features
        --no-default-features       Do not activate the `default` feature
        --target &lt;TRIPLE&gt;           Build for the target triple
        --target-dir &lt;DIR&gt;          Directory for all generated artifacts
        --ignore-rust-version       Ignore `rust-version` specification in packages
        --unit-graph                Output build graph in JSON (unstable)
        --future-incompat-report    Outputs a future incompatibility report at the end of the build
        --frozen                    Require Cargo.lock and cache are up to date
        --locked                    Require Cargo.lock is up to date
        --offline                   Run without accessing the network
        --config &lt;KEY=VALUE&gt;        Override a configuration value (unstable)
    -Z &lt;FLAG&gt;                       Unstable (nightly-only) flags to Cargo, see 'cargo -Z help' for
                                    details

FILTER OPTIONS:
        --run-ignored &lt;WHICH&gt;           Run ignored tests [default: default] [possible values:
                                        default, ignored-only, all]
        --partition &lt;PARTITION&gt;         Test partition, e.g. hash:1/2 or count:2/3
        --platform-filter &lt;PLATFORM&gt;    Filter test binaries by build platform [default: any]
                                        [possible values: target, host, any]

REPORTER OPTIONS:
        --failure-output &lt;WHEN&gt;    Output stdout and stderr on failure [env:
                                   NEXTEST_FAILURE_OUTPUT=] [possible values: immediate, immediate-
                                   final, final, never]
        --success-output &lt;WHEN&gt;    Output stdout and stderr on success [env:
                                   NEXTEST_SUCCESS_OUTPUT=] [possible values: immediate, immediate-
                                   final, final, never]
        --status-level &lt;LEVEL&gt;     Test statuses to output [env: NEXTEST_STATUS_LEVEL=] [possible
                                   values: none, fail, retry, slow, pass, skip, all]

REUSE BUILD OPTIONS (EXPERIMENTAL):
        --binaries-metadata &lt;PATH&gt;    Path to binaries-metadata JSON
        --target-dir-remap &lt;PATH&gt;     Remapping for the target directory
        --cargo-metadata &lt;PATH&gt;       Path to cargo metadata JSON
        --workspace-remap &lt;PATH&gt;      Remapping for the workspace root
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listing-tests"><a class="header" href="#listing-tests">Listing tests</a></h1>
<p>To build and list all tests in a workspace<sup class="footnote-reference"><a href="#doctest">1</a></sup>, cd into the workspace and run:</p>
<pre><code>cargo nextest list
</code></pre>
<p><code>cargo nextest list</code> takes most of the same options that <code>cargo nextest run</code> takes. For a full list of options accepted, see <code>cargo nextest list --help</code>.</p>
<p><img src="book/../static/nextest-list.png" alt="Output of cargo nextest list" /></p>
<div class="footnote-definition" id="doctest"><sup class="footnote-definition-label">1</sup>
<p>Doctests are currently <a href="https://github.com/nextest-rs/nextest/issues/16">not supported</a> because of limitations in stable Rust.</p>
</div>
<h2 id="options-and-arguments-1"><a class="header" href="#options-and-arguments-1">Options and arguments</a></h2>
<pre><code>cargo-nextest-list 
List tests in workspace

USAGE:
    cargo nextest list [OPTIONS] [FILTERS]...

ARGS:
    &lt;FILTERS&gt;...    Test name filter

OPTIONS:
        --manifest-path &lt;PATH&gt;    Path to Cargo.toml
    -v, --verbose                 Verbose output [env: NEXTEST_VERBOSE=]
        --color &lt;WHEN&gt;            Produce color output: auto, always, never [env: CARGO_TERM_COLOR=]
                                  [default: auto]
        --config-file &lt;PATH&gt;      Config file [default: workspace-root/.config/nextest.toml]
    -h, --help                    Print help information

CARGO OPTIONS:
        --lib                       Test only this package's library unit tests
        --bin &lt;BIN&gt;                 Test only the specified binary
        --bins                      Test all binaries
        --test &lt;TEST&gt;               Test only the specified test target
        --tests                     Test all targets
        --bench &lt;BENCH&gt;             Test only the specified bench target
        --benches                   Test all benches
        --all-targets               Test all targets
    -p, --package &lt;PACKAGES&gt;        Package to test
        --workspace                 Build all packages in the workspace
        --exclude &lt;EXCLUDE&gt;         Exclude packages from the test
        --all                       Alias for workspace (deprecated)
    -r, --release                   Build artifacts in release mode, with optimizations
        --cargo-profile &lt;NAME&gt;      Build artifacts with the specified Cargo profile
        --build-jobs &lt;JOBS&gt;         Number of build jobs to run
        --features &lt;FEATURES&gt;       Space or comma separated list of features to activate
        --all-features              Activate all available features
        --no-default-features       Do not activate the `default` feature
        --target &lt;TRIPLE&gt;           Build for the target triple
        --target-dir &lt;DIR&gt;          Directory for all generated artifacts
        --ignore-rust-version       Ignore `rust-version` specification in packages
        --unit-graph                Output build graph in JSON (unstable)
        --future-incompat-report    Outputs a future incompatibility report at the end of the build
        --frozen                    Require Cargo.lock and cache are up to date
        --locked                    Require Cargo.lock is up to date
        --offline                   Run without accessing the network
        --config &lt;KEY=VALUE&gt;        Override a configuration value (unstable)
    -Z &lt;FLAG&gt;                       Unstable (nightly-only) flags to Cargo, see 'cargo -Z help' for
                                    details

FILTER OPTIONS:
        --run-ignored &lt;WHICH&gt;           Run ignored tests [default: default] [possible values:
                                        default, ignored-only, all]
        --partition &lt;PARTITION&gt;         Test partition, e.g. hash:1/2 or count:2/3
        --platform-filter &lt;PLATFORM&gt;    Filter test binaries by build platform [default: any]
                                        [possible values: target, host, any]

OUTPUT OPTIONS:
    -T, --message-format &lt;FMT&gt;    Output format [default: human] [possible values: human, json,
                                  json-pretty]
        --list-type &lt;TYPE&gt;        Type of listing [default: full] [possible values: full, binaries-
                                  only]

REUSE BUILD OPTIONS (EXPERIMENTAL):
        --binaries-metadata &lt;PATH&gt;    Path to binaries-metadata JSON
        --target-dir-remap &lt;PATH&gt;     Remapping for the target directory
        --cargo-metadata &lt;PATH&gt;       Path to cargo metadata JSON
        --workspace-remap &lt;PATH&gt;      Remapping for the workspace root
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="retries-and-flaky-tests"><a class="header" href="#retries-and-flaky-tests">Retries and flaky tests</a></h1>
<p>Sometimes, tests fail nondeterministically, which can be quite annoying to developers locally and in CI. cargo-nextest supports <em>retrying</em> failed tests with the <code>--retries</code> option. If a test succeeds during a retry, the test is marked <em>flaky</em>. Here's an example:</p>
<p><img src="book/../static/nextest-retry.png" alt="Output of cargo nextest run --retries 2" /></p>
<p><code>--retries 2</code> means that the test is retried twice, for a total of three attempts. In this case, the test fails on the first try but succeeds on the second try. The <code>TRY 2 PASS</code> text means that the test passed on the second try.</p>
<p>Flaky tests are treated as ultimately successful. If there are no other tests that failed, the exit code for the test run is 0.</p>
<p>Retries can also be <a href="book/configuration.html">configured in <code>.config/nextest.toml</code></a>. The command-line <code>--retries</code> option overrides the configured value.</p>
<p>Flaky test detection is integrated with nextest's JUnit support. For more information, see <a href="book/junit.html">JUnit support</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="partitioning-test-runs-in-ci"><a class="header" href="#partitioning-test-runs-in-ci">Partitioning test runs in CI</a></h1>
<p>For CI scenarios where test runs take too long on a single machine, nextest supports automatically <em>partitioning</em> or <em>sharding</em> tests into buckets.</p>
<p>cargo-nextest supports both <em>hash-based</em> and <em>count-based</em> partitioning. Here's an example of count-based partitioning, running tests in bucket 1 of 2.</p>
<p><img src="book/../static/nextest-partition.png" alt="Output of cargo nextest run --partition count:1/2" /></p>
<p>Tests not in the current bucket are marked skipped.</p>
<p>Count-based partitioning is done <em>per test binary</em>. This means that the tests in one binary <em>do not</em> influence counting for other binaries.</p>
<p>Hash-based partitioning is similar, except buckets are specified in the format <code>hash:m/n</code>, where <code>m</code> is the current bucket and <code>n</code> is the number of buckets. The hash is completely deterministic, and is based on a combination of the binary and test names. For sufficiently large test runs, hash-based partitioning produces roughly the same number of tests per bucket.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="target-runners"><a class="header" href="#target-runners">Target runners</a></h1>
<p>If you're cross-compiling Rust code, you may wish to run tests through a wrapper executable or script. For this purpose, nextest supports <em>target runners</em>, using the same configuration options used by Cargo:</p>
<ul>
<li>The environment variable <code>CARGO_TARGET_&lt;triple&gt;_RUNNER</code>, if it matches the target platform, takes highest precedence.</li>
<li>Otherwise, nextest reads <a href="https://doc.rust-lang.org/cargo/reference/config.html#targettriplerunner">the <code>target.&lt;triple&gt;.runner</code> and <code>target.&lt;cfg&gt;.runner</code> settings</a> from <code>.cargo/config.toml</code>.</li>
</ul>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<p>If you're on Linux cross-compiling to Windows, you can choose to run tests through <a href="https://www.winehq.org/">Wine</a>.</p>
<p>If you add the following to <code>.cargo/config.toml:</code></p>
<pre><code class="language-toml">[target.x86_64-pc-windows-msvc]
runner = &quot;wine&quot;
</code></pre>
<p>Or, in your shell:</p>
<pre><code>export CARGO_TARGET_X86_64_PC_WINDOWS_MSVC_RUNNER=wine
</code></pre>
<p>Then, running this command will cause your tests to be run as <code>wine &lt;test-binary&gt;</code>:</p>
<pre><code>cargo nextest run --target x86_64-pc-windows-msvc
</code></pre>
<blockquote>
<p><strong>Note:</strong> If your target runner is a shell script, it might malfunction on macOS due to System Integrity Protection's environment sanitization. This is a system limitation with macOS and not a bug in nextest.</p>
<p>See the discussion in <a href="https://github.com/nextest-rs/nextest/pull/84">PR #84</a> for more.</p>
</blockquote>
<h2 id="cross-compiling"><a class="header" href="#cross-compiling">Cross-compiling</a></h2>
<p>While cross-compiling code, some tests may need to be run on the host platform. (See the note about <a href="book/running.html#filtering-by-build-platform">Filtering by build platform</a> for more.)</p>
<p>For tests that run on the host platform, nextest uses the target runner defined for the host. For example, if cross-compiling from <code>x86_64-unknown-linux-gnu</code> to <code>x86_64-pc-windows-msvc</code>, nextest will use the <code>CARGO_TARGET_X86_64_UNKNOWN_LINUX_GNU_RUNNER</code> for proc-macro and other host-only tests, and <code>CARGO_TARGET_X86_64_PC_WINDOWS_MSVC_RUNNER</code> for other tests.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="other-options"><a class="header" href="#other-options">Other options</a></h1>
<p>Some other options accepted by <code>cargo nextest run</code>. Many of these options are also accepted as <a href="book/configuration.html">configuration settings</a> and <a href="book/env-vars.html">environment variables</a>.</p>
<h3 id="runner-options"><a class="header" href="#runner-options">Runner options</a></h3>
<ul>
<li><code>--no-fail-fast</code>: do not exit the test run on the first failure. Most useful for CI scenarios.</li>
<li><code>-j, --test-threads</code>: number of tests to run simultaneously. Note that this is separate from the number of build jobs to run simultaneously, which is specified by <code>--build-jobs</code>.</li>
<li><code>--run-ignored ignored-only</code> runs ignored tests, while <code>--run-ignored all</code> runs both ignored and non-ignored tests.</li>
</ul>
<h3 id="reporter-options"><a class="header" href="#reporter-options">Reporter options</a></h3>
<ul>
<li><code>--failure-output</code> and <code>--success-output</code> control when standard output and standard error are displayed for failing and passing tests, respectively. The possible values are:
<ul>
<li><code>immediate</code>: display output as soon as the test fails. Default for <code>--failure-output</code>.</li>
<li><code>final</code>: display output at the end of the test run.</li>
<li><code>immediate-final</code>: display output as soon as the test fails, and at the end of the run. This is most useful for CI jobs.</li>
<li><code>never</code>: never display output. Default for <code>--success-output</code>.</li>
</ul>
</li>
<li><code>--status-level</code>: which test statuses (<strong>PASS</strong>, <strong>FAIL</strong> etc) to display. There are 7 status levels: <code>none, fail, retry, slow, pass, skip, all</code>. Each status level causes all earlier status levels to be displayed as well (similar to log levels). (For example, setting <code>status-level</code> to <code>skip</code> will show failing, retried, slow and passing tests along with skipped tests.) The default is <code>pass</code>.</li>
</ul>
<p>For a full list of options, see <a href="book/running.html#options-and-arguments">Options and arguments</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h1>
<p>This section contains information about the environment variables nextest reads and sets.</p>
<h2 id="environment-variables-nextest-reads"><a class="header" href="#environment-variables-nextest-reads">Environment variables nextest reads</a></h2>
<p>Nextest reads some of its command-line options as environment variables. In all cases, passing in a command-line option overrides the respective environment variable.</p>
<ul>
<li><code>NEXTEST_PROFILE</code> — <a href="book/configuration.html#profiles">Nextest profile</a> to use while running tests.</li>
<li><code>NEXTEST_TEST_THREADS</code> — Number of tests to run simultaneously.</li>
<li><code>NEXTEST_FAILURE_OUTPUT</code> and <code>NEXTEST_SUCCESS_OUTPUT</code> — When standard output and standard error are displayed for failing and passing tests, respectively. See <a href="book/other-options.html#reporter-options">Reporter options</a> for possible values.</li>
<li><code>NEXTEST_STATUS_LEVEL</code> — Which test statuses (<strong>PASS</strong>, <strong>FAIL</strong> etc) to display. See <a href="book/other-options.html#reporter-options">Reporter options</a> for possible values.</li>
<li><code>NEXTEST_VERBOSE</code> — Verbose output.</li>
</ul>
<p>Nextest also reads the following environment variables to emulate Cargo's behavior.</p>
<ul>
<li><code>CARGO</code> — Path to the <code>cargo</code> binary to use for builds.</li>
<li><code>CARGO_TARGET_DIR</code> — Location of where to place all generated artifacts, relative to the current working directory.</li>
<li><code>CARGO_TARGET_&lt;triple&gt;_RUNNER</code> — Support for <a href="book/target-runners.html">target runners</a>.</li>
<li><code>CARGO_TERM_COLOR</code> — The default color mode: <code>always</code>, <code>auto</code> or <code>never</code>.</li>
</ul>
<h3 id="cargo-related-environment-variables-nextest-reads"><a class="header" href="#cargo-related-environment-variables-nextest-reads">Cargo-related environment variables nextest reads</a></h3>
<p>cargo-nextest delegates to Cargo for the build, which recognizes a number of environment variables. See <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-reads">Environment variables Cargo reads</a> for a full list.</p>
<h2 id="environment-variables-nextest-sets"><a class="header" href="#environment-variables-nextest-sets">Environment variables nextest sets</a></h2>
<p>cargo-nextest exposes these environment variables to your tests <em>at runtime only</em>. They are not set at build time because cargo-nextest may reuse builds done outside of the nextest environment.</p>
<ul>
<li><code>NEXTEST</code> — always set to <code>&quot;1&quot;</code>.</li>
<li><code>NEXTEST_EXECUTION_MODE</code> — currently, always set to <code>process-per-test</code>. More options may be added in the future if nextest gains the ability to run all tests within the same process (<a href="https://github.com/nextest-rs/nextest/issues/27">#27</a>).</li>
</ul>
<h3 id="cargo-related-environment-variables-nextest-sets"><a class="header" href="#cargo-related-environment-variables-nextest-sets">Cargo-related environment variables nextest sets</a></h3>
<p>cargo-nextest delegates to Cargo for the build, which controls the environment variables that are set. See <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-crates">Environment variables Cargo sets for crates</a> for a full list.</p>
<p>cargo-nextest also sets these environment variables at runtime, matching the behavior of cargo test:</p>
<ul>
<li><code>CARGO</code> — Path to the <code>cargo</code> binary performing the build.</li>
<li><code>CARGO_MANIFEST_DIR</code> — The directory containing the manifest of your package.</li>
<li><code>CARGO_PKG_VERSION</code> — The full version of your package.</li>
<li><code>CARGO_PKG_VERSION_MAJOR</code> — The major version of your package.</li>
<li><code>CARGO_PKG_VERSION_MINOR</code> — The minor version of your package.</li>
<li><code>CARGO_PKG_VERSION_PATCH</code> — The patch version of your package.</li>
<li><code>CARGO_PKG_VERSION_PRE</code> — The pre-release version of your package.</li>
<li><code>CARGO_PKG_AUTHORS</code> — Colon separated list of authors from the manifest of your package.</li>
<li><code>CARGO_PKG_NAME</code> — The name of your package.</li>
<li><code>CARGO_PKG_DESCRIPTION</code> — The description from the manifest of your package.</li>
<li><code>CARGO_PKG_HOMEPAGE</code> — The home page from the manifest of your package.</li>
<li><code>CARGO_PKG_REPOSITORY</code> — The repository from the manifest of your package.</li>
<li><code>CARGO_PKG_LICENSE</code> — The license from the manifest of your package.</li>
<li><code>CARGO_PKG_LICENSE_FILE</code> — The license file from the manifest of your package.</li>
</ul>
<h3 id="dynamic-library-paths"><a class="header" href="#dynamic-library-paths">Dynamic library paths</a></h3>
<p>Nextest sets the dynamic library path at runtime, similar to <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#dynamic-library-paths">what Cargo does</a>. This helps with locating shared libraries that are part of the build process. The variable name depends on the platform:</p>
<ul>
<li>Windows: <code>PATH</code></li>
<li>macOS: <code>DYLD_FALLBACK_LIBRARY_PATH</code></li>
<li>Unix: <code>LD_LIBRARY_PATH</code></li>
</ul>
<p>Nextest includes the following paths:</p>
<ul>
<li>Search paths included from any build script with the <a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html#rustc-link-search"><code>rustc-link-search</code> instruction</a>. Paths outside of the target directory are removed. It is the responsibility of the user running nextest to properly set the environment if additional libraries on the system are needed in the search path.</li>
<li>The base output directory, such as <code>target/debug</code>, and the &quot;deps&quot; directory. This enables support for <code>dylib</code> dependencies and rustc compiler plugins.</li>
</ul>
<p>Nextest currently relies on being invoked as a Cargo subcommand to set the rustc sysroot library path.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="machine-readable-output"><a class="header" href="#machine-readable-output">Machine-readable output</a></h1>
<p>cargo-nextest can be configured to produce machine-readable JSON output, readable by other programs. The <a href="https://crates.io/crates/nextest-metadata">nextest-metadata crate</a> provides a Rust interface to deserialize the output to. (The same crate is used by nextest to generate the output.)</p>
<h2 id="listing-tests-1"><a class="header" href="#listing-tests-1">Listing tests</a></h2>
<p>To produce a list of tests in the JSON output format <code>cargo nextest list --message-format json</code> (or <code>json-pretty</code> for nicely formatted output). Here's some example output for the <a href="https://github.com/tokio-rs/tokio">tokio repository</a>:</p>
<pre><code class="language-json">% cargo nextest list -p tokio-util --features full --lib --message-format json-pretty
{
  &quot;test-count&quot;: 4,
  &quot;rust-build-meta&quot;: {
    &quot;target-directory&quot;: &quot;/home/rain/dev/tokio/target&quot;,
    &quot;base-output-directories&quot;: [
      &quot;debug&quot;
    ],
    &quot;linked-paths&quot;: []
  },
  &quot;rust-suites&quot;: {
    &quot;tokio-util&quot;: {
      &quot;package-name&quot;: &quot;tokio-util&quot;,
      &quot;binary-name&quot;: &quot;tokio-util&quot;,
      &quot;package-id&quot;: &quot;tokio-util 0.7.0 (path+file:///home/me/dev/tokio/tokio-util)&quot;,
      &quot;binary-path&quot;: &quot;/home/me/dev/tokio/target/debug/deps/tokio_util-def0ee51cb418fe8&quot;,
      &quot;cwd&quot;: &quot;/home/rain/dev/tokio/tokio-util&quot;,
      &quot;build-platform&quot;: &quot;target&quot;,
      &quot;testcases&quot;: {
        &quot;either::tests::either_is_async_read&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        },
        &quot;either::tests::either_is_stream&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        },
        &quot;time::wheel::level::test::test_slot_for&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        },
        &quot;time::wheel::test::test_level_for&quot;: {
          &quot;ignored&quot;: false,
          &quot;filter-match&quot;: {
            &quot;status&quot;: &quot;matches&quot;
          }
        }
      }
    }
  }
}
</code></pre>
<p>The value of <code>&quot;package-id&quot;</code> can be matched up to the package IDs produced by running <code>cargo metadata</code>.</p>
<h2 id="running-tests-1"><a class="header" href="#running-tests-1">Running tests</a></h2>
<p>This is <a href="https://github.com/nextest-rs/nextest/issues/20">currently not implemented</a>, but will be implemented in the near future.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>cargo-nextest supports repository-specific configuration at the location <code>.config/nextest.toml</code> from the Cargo workspace root. The location of the configuration file can be overridden with the <code>--config-file</code> option.</p>
<p>The default configuration shipped with cargo-nextest is:</p>
<pre><code class="language-toml"># This is the default config used by nextest. It is embedded in the binary at
# build time. It may be used as a template for .config/nextest.toml.

[store]
# The directory under the workspace root at which nextest-related files are
# written. Profile-specific storage is currently written to dir/&lt;profile-name&gt;.
dir = &quot;target/nextest&quot;

# This section defines the default nextest profile. Custom profiles are layered
# on top of the default profile.
[profile.default]
# &quot;retries&quot; defines the number of times a test should be retried. If set to a
# non-zero value, tests that succeed on a subsequent attempt will be marked as
# non-flaky. Can be overridden through the `--retries` option.
retries = 0

# Show these test statuses in the output.
#
# The possible values this can take are:
# * none: no output
# * fail: show failed (including exec-failed) tests
# * retry: show flaky and retried tests
# * slow: show slow tests
# * pass: show passed tests
# * skip: show skipped tests (most useful for CI)
# * all: all of the above
#
# Each value includes all the values above it; for example, &quot;slow&quot; includes
# failed and retried tests.
#
# Can be overridden through the `--status-level` flag.
status-level = &quot;pass&quot;

# &quot;failure-output&quot; defines when test failures are output to standard output.
# Accepted values are
# * &quot;immediate&quot;: output failures as soon as they happen
# * &quot;final&quot;: output failures at the end of the test run
# * &quot;immediate-final&quot;: output failures as soon as they happen and at the end of
#   the test run
# * &quot;never&quot;: don't output failures at all
#
# For large test suites and CI it is generally useful to use &quot;immediate-final&quot;.
#
# Can be overridden through the `--failure-output` option.
failure-output = &quot;immediate&quot;

# &quot;success-output&quot; controls output on success. This should generally be set to
# &quot;never&quot;.
success-output = &quot;never&quot;

# Cancel the test run on the first failure. For CI runs, consider setting this
# to false.
fail-fast = true

# Treat a test that takes longer than this as slow, and print a message.
slow-timeout = &quot;60s&quot;

[profile.default.junit]
# Output a JUnit report into the given file inside 'store.dir/&lt;profile-name&gt;'.
# If unspecified, JUnit is not written out.

# path = &quot;junit.xml&quot;

# The name of the top-level &quot;report&quot; element in JUnit report. If aggregating
# reports across different test runs, it may be useful to provide separate names
# for each report.
report-name = &quot;nextest-run&quot;
</code></pre>
<h2 id="profiles"><a class="header" href="#profiles">Profiles</a></h2>
<p>With cargo-nextest, local and CI runs often need to use different settings. For example, CI test runs should not be cancelled as soon as the first test failure is seen.</p>
<p>cargo-nextest supports multiple <em>profiles</em>, where each profile is a set of options for cargo-nextest. Profiles are selected on the command line with the <code>-P</code> or <code>--profile</code> option. Most individual configuration settings can also be overridden at the command line.</p>
<p>Here is a recommended profile for CI runs:</p>
<pre><code class="language-toml">[profile.ci]
# Print out output for failing tests as soon as they fail, and also at the end
# of the run (for easy scrollability).
failure-output = &quot;immediate-final&quot;
# Do not cancel the test run on the first failure.
fail-fast = false
</code></pre>
<p>After checking the profile into <code>.config/nextest.toml</code>, use <code>cargo nextest --profile ci</code> in your CI runs.</p>
<h2 id="hierarchical-configuration"><a class="header" href="#hierarchical-configuration">Hierarchical configuration</a></h2>
<p>Configuration is resolved in the following order:</p>
<ol>
<li>Command-line arguments. For example, if <code>--retries=3</code> is specified on the command line, failing tests are retried up to 3 times.</li>
<li>Profile-specific configuration. For example, if <code>--profile ci</code> is selected in the example above, failing tests are retried up to 2 times.</li>
<li>Repository-specific configuration for the <code>default</code> profile. For example, if the repository-specific configuration looks like:
<pre><code class="language-toml">[profile.default]
retries = 5
</code></pre>
then failing tests are retried up to 5 times.</li>
<li>The default configuration listed above, which is that tests are never retried.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="junit-support"><a class="header" href="#junit-support">JUnit support</a></h1>
<p>cargo-nextest can produce output in the <a href="https://llg.cubic.org/docs/junit/">JUnit/XUnit XML format</a>. This format is widely understood by test analysis tools and libraries.</p>
<p>To enable JUnit support, add this to your configuration:</p>
<pre><code class="language-toml">[profile.ci.junit]  # this can be some other profile, too
path = &quot;junit.xml&quot;
</code></pre>
<p>If <code>--profile ci</code> is selected on the command line, a JUnit report will be written out to <code>target/nextest/ci/junit.xml</code> within the workspace root.</p>
<p>Some notes about the JUnit support:</p>
<ul>
<li>There are several slightly different formats all called &quot;JUnit&quot; or &quot;XUnit&quot;. cargo-nextest adheres to the <a href="https://llg.cubic.org/docs/junit/">Jenkins XML format</a>.</li>
<li>Every test binary forms a single <code>&lt;testsuite&gt;</code>. Every test forms a single <code>&lt;testcase&gt;</code>.</li>
<li>Standard output and standard error are included for failed and retried tests. (However, <a href="https://en.wikipedia.org/wiki/Valid_characters_in_XML">invalid XML characters</a> are stripped out.)</li>
</ul>
<h2 id="post-processing"><a class="header" href="#post-processing">Post-processing</a></h2>
<p>Some tools that read JUnit files don't follow the Jenkins standard. You can post-process the JUnit file in such cases. Here's some recommendations for post-processing tools written by community members:</p>
<ul>
<li>CircleCI: <a href="https://github.com/conradludgate/circleci-junit-fix"><code>circleci-junit-fix</code></a></li>
</ul>
<h2 id="example-1"><a class="header" href="#example-1">Example</a></h2>
<p>Here's an example JUnit file generated by <code>cargo-nextest</code>.</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;testsuites name=&quot;nextest-run&quot; tests=&quot;3&quot; failures=&quot;1&quot; errors=&quot;0&quot; timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.003&quot;&gt;
    &lt;testsuite name=&quot;nextest-tests::basic&quot; tests=&quot;3&quot; disabled=&quot;0&quot; errors=&quot;0&quot; failures=&quot;1&quot;&gt;
        &lt;testcase name=&quot;test_cwd&quot; classname=&quot;nextest-tests::basic&quot; timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.001&quot;&gt;
        &lt;/testcase&gt;
        &lt;testcase name=&quot;test_flaky_mod_2&quot; classname=&quot;nextest-tests::basic&quot; timestamp=&quot;2022-02-10T20:09:34.394+00:00&quot; time=&quot;0.001&quot;&gt;
            &lt;flakyFailure timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.001&quot; type=&quot;test failure&quot;&gt;
                &lt;system-out&gt;
running 1 test
test test_flaky_mod_2 ... FAILED

failures:

failures:
    test_flaky_mod_2

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_flaky_mod_2&amp;apos; panicked at &amp;apos;Failed because attempt 1 % 2 != 0&amp;apos;, tests/basic.rs:33:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/flakyFailure&gt;
        &lt;/testcase&gt;
        &lt;testcase name=&quot;test_failure_assert&quot; classname=&quot;nextest-tests::basic&quot; timestamp=&quot;2022-02-10T20:09:34.393+00:00&quot; time=&quot;0.001&quot;&gt;
            &lt;failure type=&quot;test failure&quot;/&gt;
            &lt;rerunFailure timestamp=&quot;2022-02-10T20:09:34.395+00:00&quot; time=&quot;0.001&quot; type=&quot;test failure&quot;&gt;
                &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at &amp;apos;assertion failed: `(left == right)`
  left: `4`,
 right: `5`: this is an assertion&amp;apos;, tests/basic.rs:9:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/rerunFailure&gt;
            &lt;rerunFailure timestamp=&quot;2022-02-10T20:09:34.396+00:00&quot; time=&quot;0.001&quot; type=&quot;test failure&quot;&gt;
                &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
                &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at &amp;apos;assertion failed: `(left == right)`
  left: `4`,
 right: `5`: this is an assertion&amp;apos;, tests/basic.rs:9:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
            &lt;/rerunFailure&gt;
            &lt;system-out&gt;
running 1 test
test test_failure_assert ... FAILED

failures:

failures:
    test_failure_assert

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 10 filtered out; finished in 0.00s

&lt;/system-out&gt;
            &lt;system-err&gt;thread &amp;apos;test_failure_assert&amp;apos; panicked at &amp;apos;assertion failed: `(left == right)`
  left: `4`,
 right: `5`: this is an assertion&amp;apos;, tests/basic.rs:9:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
&lt;/system-err&gt;
        &lt;/testcase&gt;
    &lt;/testsuite&gt;
&lt;/testsuites&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-coverage"><a class="header" href="#test-coverage">Test coverage</a></h1>
<p>Test coverage support is provided by third-party tools that wrap around nextest.</p>
<h2 id="llvm-cov"><a class="header" href="#llvm-cov">llvm-cov</a></h2>
<p><a href="https://github.com/taiki-e/cargo-llvm-cov">cargo-llvm-cov</a> supports nextest. To generate llvm-cov data with nextest, run:</p>
<pre><code>cargo install cargo-llvm-cov
cargo llvm-cov nextest
</code></pre>
<h3 id="using-llvm-cov-in-github-actions"><a class="header" href="#using-llvm-cov-in-github-actions">Using llvm-cov in GitHub Actions</a></h3>
<p>Install nightly Rust with the <code>llvm-tools-preview</code> component, nextest, and llvm-cov in GitHub Actions. Then, run <code>cargo llvm-cov nextest</code>.</p>
<pre><code class="language-yaml">- uses: actions-rs/toolchain@v1
  with:
    toolchain: nightly
    override: true
    components: llvm-tools-preview
- uses: taiki-e/install-action@cargo-llvm-cov
- uses: taiki-e/install-action@nextest

- name: Collect coverage data
  run: cargo llvm-cov nextest
</code></pre>
<p><a href="https://github.com/nextest-rs/nextest/blob/main/.github/workflows/coverage.yml">See this in practice with nextest's own CI.</a></p>
<blockquote>
<p>TODO: provide instructions for other report forms like HTML, and for reporting to an external code coverage service.</p>
</blockquote>
<h2 id="integrating-nextest-into-coverage-tools"><a class="header" href="#integrating-nextest-into-coverage-tools">Integrating nextest into coverage tools</a></h2>
<p>Most coverage tools work by setting a few environment variables such as <code>RUSTFLAGS</code> or <code>RUSTC_WRAPPER</code>. Nextest runs Cargo for the build, which will read those environment variables as usual. This means that it should generally be quite straightforward to integrate nextest into other coverage tools.</p>
<blockquote>
<p>If you've integrated nextest into a coverage tool, feel free to <a href="https://github.com/nextest-rs/nextest/pulls">submit a pull request</a> with documentation.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stability-policy"><a class="header" href="#stability-policy">Stability policy</a></h1>
<p>This section contains information on how cargo-nextest will evolve in a backwards-compatible way over time.</p>
<h2 id="the-cargo-nextest-binary"><a class="header" href="#the-cargo-nextest-binary">The cargo-nextest binary</a></h2>
<p>The cargo-nextest binary follows <a href="https://semver.org/">semantic versioning</a>, where the <a href="https://semver.org/#spec-item-1">public API</a> consists of exactly the following:</p>
<ol>
<li>command-line arguments, options and flags</li>
<li><a href="book/machine-readable.html">machine-readable output</a></li>
<li>the <a href="book/configuration.html">configuration file format</a></li>
</ol>
<p><a href="book/experimental-features.html">Experimental features</a> are not part of the public API. They may change or be removed in a patch release.</p>
<p>Within a version series, the public API will be append-only. New options or keys may be added, but existing keys will continue to be as they were. Existing options may be deprecated but will not be removed within a version series.</p>
<p>The public API does <em>not</em> include human-readable output generated by nextest, or in general anything printed to stderr.</p>
<h2 id="libraries"><a class="header" href="#libraries">Libraries</a></h2>
<p>The libraries used by cargo-nextest, <a href="https://crates.io/crates/nextest-metadata">nextest-metadata</a> and <a href="https://crates.io/crates/nextest-runner">nextest-runner</a>, follow the standard Rust library versioning policy.</p>
<h3 id="nextest-metadata"><a class="header" href="#nextest-metadata">nextest-metadata</a></h3>
<p>nextest-metadata contains data structures for deserializing cargo-nextest's <a href="book/machine-readable.html">machine-readable output</a>.</p>
<p><strong>nextest-metadata is forward-compatible with cargo-nextest</strong>. A given version of nextest-metadata will continue to work with all future versions of cargo-nextest (within the same version series).</p>
<p>However, currently, <strong>nextest-metadata is not backwards-compatible</strong>: a new version of nextest-metadata may not be able to parse metadata generated by older versions of cargo-nextest. In other words, each version of nextest-metadata has a minimum supported cargo-nextest version, analogous to a crate's <a href="https://rust-lang.github.io/rfcs/2495-min-rust-version.html">minimum supported Rust version (MSRV)</a>.</p>
<p>A bump to the minimum supported cargo-nextest version is considered a breaking change, and will be paired with a major version bump.</p>
<p>(The policy around backwards compatibility may be relaxed in the future based on user needs.)</p>
<h3 id="nextest-runner"><a class="header" href="#nextest-runner">nextest-runner</a></h3>
<p>nextest-runner is built to serve the needs of cargo-nextest. Breaking changes to nextest-runner will be documented in <a href="https://github.com/nextest-rs/nextest/blob/main/nextest-runner/CHANGELOG.md">its CHANGELOG</a>, but you should expect them to happen more rapidly than changes to <code>cargo-nextest</code>.</p>
<h2 id="minimum-supported-rust-version-msrv"><a class="header" href="#minimum-supported-rust-version-msrv">Minimum supported Rust version (MSRV)</a></h2>
<p>The MSRV of cargo-nextest or dependent crates may be changed in a patch release. At least the last 3 versions of Rust will be supported at any time.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="experimental-features"><a class="header" href="#experimental-features">Experimental features</a></h1>
<p>This section documents new features in nextest that aren't stable yet. These features
may be changed or removed at any time, and must be accessed through an environment variable.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="reusing-builds"><a class="header" href="#reusing-builds">Reusing builds</a></h1>
<ul>
<li><strong>Introduced in:</strong> cargo-nextest 0.9.10</li>
<li><strong>Environment variable</strong>: <code>NEXTEST_EXPERIMENTAL_REUSE_BUILD=1</code></li>
<li><strong>Tracking issue</strong>: <a href="https://github.com/nextest-rs/nextest/issues/98">#98</a></li>
</ul>
<p>In some cases, it can be useful to separate out building tests and running them. Nextest has experimental support for serializing metadata on one machine, and then using that to run tests on another machine.</p>
<h2 id="terms"><a class="header" href="#terms">Terms</a></h2>
<ul>
<li><strong>Build machine:</strong> The computer that builds tests.</li>
<li><strong>Target machine:</strong> The computer that runs tests.</li>
</ul>
<h2 id="use-cases"><a class="header" href="#use-cases">Use cases</a></h2>
<ul>
<li><strong>Cross-compilation.</strong> The build machine has a different architecture, or runs a different operating system, from the target machine.</li>
<li><strong>Test partitioning.</strong> Build once on the build machine, then <a href="book/partitioning.html">partition test execution</a> across multiple target machines.</li>
<li><strong>Saving execution time on more valuable machines.</strong> For example, build tests on a regular machine, then run them on a machine with a GPU attached to it.</li>
</ul>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li><strong>The project source must be checked out to the same revision on the target machine.</strong> This might be needed for test fixtures and other assets, and nextest sets the right working directory relative to the workspace root when executing tests.</li>
<li><strong>It is your responsibility to transfer over build artifacts.</strong> Use the examples below as a template.</li>
</ul>
<h3 id="non-requirements"><a class="header" href="#non-requirements">Non-requirements</a></h3>
<ul>
<li><strong>Cargo does not need to be installed on the target machine.</strong> If <code>cargo</code> is unavailable, replace <code>cargo nextest</code> with <code>cargo-nextest nextest</code> in the following examples.</li>
</ul>
<h2 id="new-options"><a class="header" href="#new-options">New options</a></h2>
<p>Both <code>cargo nextest list</code> and <code>cargo nextest run</code> accept the following options:</p>
<ul>
<li><code>--binaries-metadata</code>: The path to JSON metadata generated by <code>cargo nextest list --list-type binaries-only --message-format json</code>.</li>
<li><code>--binaries-dir-remap</code>: A possible new location for the directory test binaries are present in. Requires <code>--binaries-metadata</code>.</li>
<li><code>--cargo-metadata</code>: The path to JSON metadata generated by <code>cargo metadata --format-version 1</code>.</li>
<li><code>--workspace-remap</code>: A possible new location for the root of the workspace. requires <code>--cargo-metadata</code>.</li>
</ul>
<h2 id="example-simple-buildrun-split"><a class="header" href="#example-simple-buildrun-split">Example: Simple build/run split</a></h2>
<ol>
<li>Build the tests and save the binaries metadata:
<pre><code>cargo nextest list --list-type binaries-only --message-format json \
  &gt; target/binaries-metadata.json
</code></pre>
</li>
<li>List the tests:
<pre><code>cargo nextest list --binaries-metadata target/binaries-metadata.json
</code></pre>
</li>
<li>Run the tests:
<pre><code>cargo nextest run --binaries-metadata target/binaries-metadata.json
</code></pre>
</li>
</ol>
<h2 id="example-cross-compilation"><a class="header" href="#example-cross-compilation">Example: Cross-compilation</a></h2>
<p>While cross-compiling code, some tests may need to be run on the host platform. (See the note about <a href="book/running.html#filtering-by-build-platform">Filtering by build platform</a> for more.)</p>
<h3 id="on-the-build-machine"><a class="header" href="#on-the-build-machine">On the build machine</a></h3>
<ol>
<li>Save the project's cargo metadata:
<pre><code>cargo metadata --format-version=1 --all-features &gt; target/cargo-metadata.json
</code></pre>
</li>
<li>Build the tests and save the binaries metadata:
<pre><code>cargo nextest list --target &lt;TARGET&gt; --list-type binaries-only \
  --message-format json &gt; target/binaries-metadata.json
</code></pre>
</li>
<li>Run host-only tests:
<pre><code>cargo nextest run --target &lt;TARGET&gt; --platform-filter host
</code></pre>
</li>
<li>Archive the <code>target/</code> directory.</li>
</ol>
<h3 id="on-the-target-machine"><a class="header" href="#on-the-target-machine">On the target machine</a></h3>
<ol>
<li>Check out the project repository to a path <code>&lt;REPO-PATH&gt;</code>, to the same revision as the build machine.</li>
<li>Extract the archive of the <code>target/</code> directory created on the build machine to, for example, <code>&lt;REPO-PATH&gt;/target/</code>. (This doesn't have to be located here. It can be any directory on the filesystem).</li>
<li>List target-only tests:
<pre><code>cargo nextest list --platform-filter target \
    --binaries-metadata &lt;REPO-PATH&gt;/target/binaries-metadata.json \
    --cargo-metadata &lt;REPO-PATH&gt;/target/cargo-metadata.json \
    --workspace-remap &lt;REPO-PATH&gt; \
    --target-dir-remap &lt;REPO-PATH&gt;/target
</code></pre>
</li>
<li>Run target-only tests:
<pre><code>cargo nextest run --platform-filter target \
    --binaries-metadata &lt;REPO-PATH&gt;/target/binaries-metadata.json \
    --cargo-metadata &lt;REPO-PATH&gt;/target/cargo-metadata.json \
    --workspace-remap &lt;REPO-PATH&gt; \
    --target-dir-remap &lt;REPO-PATH&gt;/target
</code></pre>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filter-expression-dsl"><a class="header" href="#filter-expression-dsl">Filter expression DSL</a></h1>
<ul>
<li><strong>Introduced in:</strong> cargo-nextest 0.9.13 (not released yet)</li>
<li><strong>Environment variable</strong>: <code>NEXTEST_EXPERIMENTAL_EXPR_FILTER=1</code></li>
<li><strong>Tracking issue</strong>: []</li>
</ul>
<p>Nextest supports a domain-specific language (DSL) for filtering tests. The DSL is inspired by, and is similar to, <a href="https://bazel.build/docs/query-how-to">Bazel query</a> and <a href="https://www.mercurial-scm.org/repo/hg/help/revsets">Mercurial revsets</a>.</p>
<h2 id="example-running-all-tests-in-a-crate-and-its-dependencies"><a class="header" href="#example-running-all-tests-in-a-crate-and-its-dependencies">Example: Running all tests in a crate and its dependencies</a></h2>
<p>To run all tests in <code>my-crate</code> and its dependencies, run:</p>
<pre><code>cargo nextest run -E 'deps(=my-crate)'
</code></pre>
<p>The argument passed into the <code>-E</code> command-line option is called a <em>filter expression</em>. The rest of this page describes the full syntax for the expression DSL.</p>
<h2 id="the-filter-expression-dsl"><a class="header" href="#the-filter-expression-dsl">The filter expression DSL</a></h2>
<p>A <em>filter expression</em> defines a set of tests. A test will be run if it matches a filter expression.</p>
<p>On the command line, multiple filter expressions can be passed in. A test will be run if it matches any of these expressions. For example, to run tests whose names contain the string <code>my_test</code> as well as all tests in package <code>my-crate</code>, run:</p>
<pre><code>cargo nextest run -E 'test(my_test)' -E 'package(=my-crate)'
</code></pre>
<p>This is equivalent to:</p>
<pre><code>cargo nextest run -E 'test(my_test) + package(=my-crate)'
</code></pre>
<h3 id="examples-1"><a class="header" href="#examples-1">Examples</a></h3>
<ul>
<li><code>package(=serde) and test(deserialize)</code>: every test containing the string <code>deserialize</code> in the package <code>serde</code></li>
<li><code>not (test(/parse[0-9]*/) | test(run))</code>: every test containing <code>parse</code> or <code>run</code></li>
</ul>
<h2 id="dsl-reference"><a class="header" href="#dsl-reference">DSL reference</a></h2>
<p>This section contains the full set of operators supported by the DSL.</p>
<h3 id="basic-sets"><a class="header" href="#basic-sets">Basic sets</a></h3>
<ul>
<li><code>all()</code>: include all tests.</li>
<li><code>test(name-matcher)</code>: include all tests matching <code>name-matcher</code>.</li>
<li><code>package(name-matcher)</code>: include all tests in packages (crates) matching <code>name-matcher</code>.</li>
<li><code>deps(name-matcher)</code>: include all tests in crates matching <code>name-matcher</code>, and all of their (possibly transitive) dependencies.</li>
<li><code>rdeps(name-matcher)</code>: include all tests in crates matching <code>name-matcher</code>, and all the crates that (possibly transitively) depend on <code>name-matcher</code>.</li>
<li><code>none()</code>: include no tests.</li>
</ul>
<h3 id="name-matchers"><a class="header" href="#name-matchers">Name matchers</a></h3>
<ul>
<li><code>string</code> or <code>contains:string</code>: match a package or test name containing <code>string</code></li>
<li><code>=string</code>: match a package or test name that's equal to <code>string</code></li>
<li><code>/regex/</code>: match a package or test name if any part of it matches the regular expression <code>regex</code>. To match the entire string against a regular expression, use <code>/^regex$/</code>. The implementation uses the regex crate.</li>
</ul>
<p>To match a string beginning with <code>=</code> or <code>/</code>, or if you're constructing an expression string in a programmatic context, use the <code>contains:</code> prefix.</p>
<h4 id="escape-sequences"><a class="header" href="#escape-sequences">Escape sequences</a></h4>
<p>The <em>contains</em> and <em>equality</em> name matchers can contain escape sequences, preceded by a backslash (<code>\</code>).</p>
<ul>
<li><code>\n</code>: line feed</li>
<li><code>\r</code>: carriage return</li>
<li><code>\t</code>: tab</li>
<li><code>\\</code>: backslash</li>
<li><code>\/</code>: forward slash</li>
<li><code>\)</code>: closing parenthesis</li>
<li><code>\u{7FFF}</code>: 24-bit Unicode character code (up to 6 hex digits)</li>
</ul>
<p>All other escape sequences are invalid.</p>
<p>The <em>regular expression</em> matcher supports the same escape sequences that <a href="https://docs.rs/regex/latest/regex/#escape-sequences">the regex crate does</a>.</p>
<p>TODO: add a way to escape <code>/</code> in regexes.</p>
<h3 id="operators"><a class="header" href="#operators">Operators</a></h3>
<ul>
<li><code>set_1 &amp; set_2</code> , <code>set_1 and set_2</code>: the intersection of <code>set_1</code> and <code>set_2</code></li>
<li><code>set_1 | set_2</code>, <code>set_1 or set_2</code>, <code>set_1 + set_2</code>: the union of <code>set_1</code> or <code>set_2</code></li>
<li><code>not set</code>, <code>!set</code>: include everything not included in <code>set</code></li>
<li><code>set_1 - set_2</code>: equivalent to <code>set_1 and not set_2</code></li>
<li><code>(set)</code>: include everything in <code>set</code></li>
</ul>
<h4 id="operator-precedence"><a class="header" href="#operator-precedence">Operator precedence</a></h4>
<p>In order from highest to lowest, or in other words from tightest to loosest binding:</p>
<ol>
<li><code>()</code></li>
<li><code>not</code>, <code>!</code></li>
<li><code>and</code>, <code>&amp;</code>, <code>-</code></li>
<li><code>or</code>, <code>|</code></li>
</ol>
<p>Within a precedence group, operators bind from left to right.</p>
<h5 id="examples-2"><a class="header" href="#examples-2">Examples</a></h5>
<ul>
<li><code>test(a) &amp; test(b) | test(c)</code> is equivalent to <code>(test(a) &amp; test(b)) | test(c)</code>.</li>
<li><code>test(a) | test(b) &amp; test(c)</code> is equivalent to <code>test(a) | (test(b) &amp; test(c))</code>.</li>
<li><code>test(a) &amp; test(b) - test(c)</code> is equivalent to <code>(test(a) &amp; test(b)) - test(c)</code>.</li>
<li><code>not test(a) | test(b)</code> is equivalent to <code>(not test(a)) | test(b)</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-nextest-works"><a class="header" href="#how-nextest-works">How nextest works</a></h1>
<p>To understand how nextest works, it is useful to first look at the execution model used by cargo test.</p>
<h2 id="the-cargo-test-execution-model"><a class="header" href="#the-cargo-test-execution-model">The cargo test execution model</a></h2>
<p>By default, cargo test uses this execution model:</p>
<p><img src="book/../static/cargo-test-model.png" alt="Cargo test execution model" /></p>
<p>In this model, each test binary is run serially, and binaries are responsible for running individual tests in parallel.</p>
<p>This model provides the greatest flexibility because <em>the only interface between cargo test and the binary is the exit code</em>. For cargo test, a binary exiting with exit code 0 means that all tests within it passed, while a non-zero exit code means that some tests within it failed.</p>
<p>However, this model has several problems:</p>
<ol>
<li><strong>There's no structured way to get individual test pass/fail status</strong>, or the time taken by each test.</li>
<li><strong>The first binary failure means that no further tests are run</strong>, unless <code>--no-fail-fast</code> is passed in. If that argument is passed in in CI scenarios, then failing test output is not printed at the end, making it hard to figure out which tests failed.</li>
<li><strong>Performance can be affected by test bottlenecks.</strong> For example, if a binary has 20 tests and 19 of them take less than 5s, while one of them takes 60s, then the test binary will take 60s to complete execution. <code>cargo test</code> has no way to start running other test binaries in those last 55 seconds. </li>
</ol>
<h2 id="the-nextest-model"><a class="header" href="#the-nextest-model">The nextest model</a></h2>
<p>cargo-nextest uses a very different execution model, inspired by state-of-the-art test runners used at large corporations. Here's what cargo-nextest does:</p>
<p><img src="book/../static/nextest-model.png" alt="Nextest execution model" /></p>
<p>A cargo-nextest run has two separate phases:</p>
<ul>
<li><strong>The list phase.</strong> cargo-nextest first builds all test binaries with <code>cargo test --no-run</code>, then queries those binaries to produce a list of all tests within them.</li>
<li><strong>The run phase.</strong> cargo-nextest then executes each individual test in a separate process, in parallel. It then collects, displays and aggregates results for each individual test.</li>
</ul>
<p>This model solves all the problems of cargo test's execution model, at the cost of a <em>significantly</em> thicker interface to test binaries. This means that <strong>custom test harnesses <a href="book/custom-test-harnesses.html">may need to be adapted</a> to work with cargo-nextest.</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="benchmarks"><a class="header" href="#benchmarks">Benchmarks</a></h1>
<p>Nextest's <a href="book/how-it-works.html">execution model</a> generally leads to faster test runs than Cargo. How much faster depends on the specifics, but here are some general guidelines:</p>
<ul>
<li><em>Larger workspaces will see a greater benefit.</em> This is because larger workspaces have more crates, more test binaries, and more potential spots for bottlenecks. </li>
<li><em>Test bottlenecks.</em> Nextest excels in situations where there are bottlenecks in multiple test binaries: cargo test can only run them serially, while nextest can run those tests in parallel.</li>
<li><em>Build caching.</em> Test runs are one component of end-to-end execution times. Speeding up the build by using <a href="https://github.com/mozilla/sccache">sccache</a>, the <a href="https://github.com/marketplace/actions/rust-cache">Rust Cache GitHub Action</a>, or similar, will make test run times be a proportionally greater part of overall times.</li>
</ul>
<p>Even if nextest doesn't result in faster test builds, you may find doing occasional nextest runs useful for identifying test bottlenecks, for its user interface, or for its other features like test retries.</p>
<h2 id="results"><a class="header" href="#results">Results</a></h2>
<table><thead><tr><th>Project</th><th>Revision</th><th style="text-align: right">Test count</th><th style="text-align: right">cargo test (s)</th><th style="text-align: right">nextest (s)</th><th style="text-align: right">Difference</th></tr></thead><tbody>
<tr><td><a href="https://github.com/facebookincubator/cargo-guppy/">cargo-guppy</a></td><td><a href="https://github.com/facebookincubator/cargo-guppy/commit/c135447af716d0f985557b40042b2b6df53fa653"><code>c135447a</code></a></td><td style="text-align: right">252</td><td style="text-align: right">34.70</td><td style="text-align: right">22.14</td><td style="text-align: right">-36.2%</td></tr>
<tr><td><a href="https://github.com/diem/diem">diem</a><sup class="footnote-reference"><a href="#diem1">1</a></sup></td><td><a href="https://github.com/diem/diem/commit/6025888b264793bc2112d2ad3a6ef40f0861ee08"><code>6025888b</code></a></td><td style="text-align: right">1476</td><td style="text-align: right">1058.46</td><td style="text-align: right">400.53</td><td style="text-align: right">-62.1%</td></tr>
<tr><td><a href="https://github.com/penumbra-zone/penumbra">penumbra</a></td><td><a href="https://github.com/penumbra-zone/penumbra/commit/44ab43f62bafa861608ac3f2e6deabb456c43983"><code>44ab43f6</code></a></td><td style="text-align: right">32</td><td style="text-align: right">54.66</td><td style="text-align: right">24.90</td><td style="text-align: right">-54.4%</td></tr>
<tr><td><a href="https://github.com/briansmith/ring">ring</a></td><td><a href="https://github.com/briansmith/ring/commit/c14c355f51c537c99ff43935c88c22c2e04980a3"><code>c14c355f</code></a></td><td style="text-align: right">179</td><td style="text-align: right">17.64</td><td style="text-align: right">11.60</td><td style="text-align: right">-34.2%</td></tr>
<tr><td><a href="https://github.com/rust-analyzer/rust-analyzer">rust-analyzer</a></td><td><a href="https://github.com/rust-analyzer/rust-analyzer/commit/4449a336f6965ebdfa9b7408e6ff40a6a990a43d"><code>4449a336</code></a></td><td style="text-align: right">3746</td><td style="text-align: right">6.76</td><td style="text-align: right">5.23</td><td style="text-align: right">-22.6%</td></tr>
<tr><td><a href="https://github.com/tokio-rs/tokio">tokio</a></td><td><a href="https://github.com/tokio-rs/tokio/commit/e7a0da60cd997f10b33f32c4763c8ecef01144f8"><code>e7a0da60</code></a></td><td style="text-align: right">1014</td><td style="text-align: right">27.16</td><td style="text-align: right">11.72</td><td style="text-align: right">-56.8%</td></tr>
</tbody></table>
<div class="footnote-definition" id="diem1"><sup class="footnote-definition-label">1</sup>
<p>Diem ships its own in-tree tool on top of <a href="https://crates.io/crates/nextest-runner">nextest-runner</a>, so the commands were slightly different:</p>
<ul>
<li>the command for cargo test is <code>cargo xtest --unit</code></li>
<li>the command for running nextest is <code>cargo nextest --unit</code></li>
</ul>
</div>
<h2 id="specifications"><a class="header" href="#specifications">Specifications</a></h2>
<p>All measurements were done on:</p>
<ul>
<li><strong>Processor:</strong> AMD Ryzen 9 3900x x86_64, 12 cores/24 threads</li>
<li><strong>Operating system:</strong> Pop_OS! 21.04 running Linux kernel 5.15.15</li>
<li><strong>RAM:</strong> 64GB</li>
<li><strong>Rust:</strong> version 1.58.1</li>
</ul>
<p>Lines of code were measured by <code>loc</code>, while the number of tests was recorded by nextest.</p>
<p>The commands run were:</p>
<ul>
<li><strong>cargo test:</strong> <code>cargo test --workspace --bins --lib --tests</code> (to exclude doctests since they're not supported by nextest)</li>
<li><strong>nextest:</strong> <code>cargo nextest run --workspace</code></li>
</ul>
<p>The measurements do not include time taken to build the tests. To ensure that, each command was run 5 times in succession. The measurement recorded is the minimum of runs 3, 4 and 5.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-test-harnesses"><a class="header" href="#custom-test-harnesses">Custom test harnesses</a></h1>
<p>A custom test harness is defined in <code>Cargo.toml</code> as:</p>
<pre><code class="language-toml">[[test]]
name = &quot;my-test&quot;
harness = false
</code></pre>
<p>As mentioned in <a href="book/how-it-works.html">How nextest works</a>, cargo-nextest has a much thicker interface with the test harness than cargo test does. If you don't use any custom harnesses, cargo-nextest will run out of the box. However, users of custom test harnesses may need to be changed to work with cargo nextest. In general, the changes make the test harness look more like the default Rust test harness, and are pretty small overall.</p>
<ul>
<li>
<p><strong>Custom test harnesses MUST support being run with <code>--list --format terse</code>.</strong> This command MUST print to stdout all tests in <em>exactly</em> the format</p>
<pre><code>my-test-1: test
my-test-2: test
</code></pre>
<p>Other output MUST NOT be written to stdout.</p>
<p>Custom test harnesses that are meant to be run as a single unit MUST produce just one line in the output.</p>
</li>
<li>
<p><strong>Custom test harnesses MUST support being run with <code>--list --format terse --ignored</code></strong>. This command MUST print to stdout exactly the set of ignored tests (however the harness defines them) in the same format as above. If there are no ignored tests or if the test harness doesn't support ignored tests, the output MUST be empty. The set of ignored tests MUST be either of the following two options:</p>
<ul>
<li>A subset of the tests printed out without <code>--ignored</code>; this is what libtest does.</li>
<li>A completely disjoint set of tests from those printed out without <code>--ignored</code>.</li>
</ul>
</li>
<li>
<p><strong>Test names that are not at the top level (however the harness defines this) SHOULD be returned as <code>path::to::test::test_name</code>.</strong> This is recommended because the cargo-nextest UI uses <code>::</code> as a separator to format test names nicely.</p>
</li>
<li>
<p><strong>Custom test harnesses MUST support being run with <code>&lt;test-name&gt; --nocapture --exact</code></strong>. This command will be called with every test name provided by the harness in <code>--list</code> above.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<p>This page documents new features and bugfixes for cargo-nextest. Please see the <a href="book/stability.html">stability
policy</a> for how versioning works with cargo-nextest.</p>
<h2 id="0912---2022-03-22"><a class="header" href="#0912---2022-03-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.12">0.9.12</a> - 2022-03-22</a></h2>
<h3 id="added"><a class="header" href="#added">Added</a></h3>
<ul>
<li>Support for reading some configuration as <a href="https://nexte.st/book/env-vars#environment-variables-nextest-reads">environment variables</a>. (Thanks <a href="https://github.com/ymgyt">ymgyt</a> and <a href="https://github.com/iskyzh">iskyzh</a> for their pull requests!)</li>
<li><a href="https://nexte.st/book/machine-readable">Machine-readable output</a> for <code>cargo nextest list</code> now contains a <code>rust-build-meta</code> key. This key currently contains the target directory, the base output directories, and paths to <a href="https://nexte.st/book/env-vars#dynamic-library-paths">search for dynamic libraries in</a> relative to the target directory.</li>
</ul>
<h3 id="fixed"><a class="header" href="#fixed">Fixed</a></h3>
<ul>
<li>Test binaries that link to dynamic libraries built by Cargo now work correctly (<a href="https://github.com/nextest-rs/nextest/issues/82">#82</a>).</li>
<li>Crates with no tests are now skipped while computing padding widths in the reporter (<a href="https://github.com/nextest-rs/nextest/issues/125">#125</a>).</li>
</ul>
<h3 id="changed"><a class="header" href="#changed">Changed</a></h3>
<ul>
<li>MSRV updated to Rust 1.56.</li>
<li>For experimental feature <a href="https://nexte.st/book/reusing-builds">reusing builds</a>:
<ul>
<li>Change <code>--binaries-dir-remap</code> to <code>--target-dir-remap</code> and expect that the entire target directory is archived.</li>
<li>Support linking to dynamic libraries (<a href="https://github.com/nextest-rs/nextest/issues/82">#82</a>).</li>
</ul>
</li>
</ul>
<h2 id="0911---2022-03-09"><a class="header" href="#0911---2022-03-09"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.11">0.9.11</a> - 2022-03-09</a></h2>
<h3 id="fixed-1"><a class="header" href="#fixed-1">Fixed</a></h3>
<ul>
<li>Update <code>regex</code> to 1.5.5 to address <a href="https://github.com/rust-lang/regex/security/advisories/GHSA-m5pq-gvj9-9vr8">GHSA-m5pq-gvj9-9vr8
(CVE-2022-24713)</a>.</li>
</ul>
<h2 id="0910---2022-03-07"><a class="header" href="#0910---2022-03-07"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.10">0.9.10</a> - 2022-03-07</a></h2>
<p>Thanks to <a href="https://github.com/Guiguiprim">Guiguiprim</a> for their contributions to this release!</p>
<h3 id="added-1"><a class="header" href="#added-1">Added</a></h3>
<ul>
<li>A new <code>--platform-filter</code> option filters tests by the platform they run on (target or host).</li>
<li><code>cargo nextest list</code> has a new <code>--list-type</code> option, with values <code>full</code> (the default, same as today) and <code>binaries-only</code> (list out binaries without querying them for the tests they contain).</li>
<li>Nextest executions done as a separate process per test (currently the only supported method, though this might change in the future) set the environment variable <code>NEXTEST_PROCESS_MODE=process-per-test</code>.</li>
</ul>
<h3 id="new-experimental-features"><a class="header" href="#new-experimental-features">New experimental features</a></h3>
<ul>
<li>Nextest can now reuse builds across invocations and machines. This is an experimental feature, and feedback is welcome in <a href="https://github.com/nextest-rs/nextest/issues/98">#98</a>!</li>
</ul>
<h3 id="changed-1"><a class="header" href="#changed-1">Changed</a></h3>
<ul>
<li>The target runner is now build-platform-specific; test binaries built for the host platform will be run by the target runner variable defined for the host, and similarly for the target platform.</li>
</ul>
<h2 id="099---2022-03-03"><a class="header" href="#099---2022-03-03"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.9">0.9.9</a> - 2022-03-03</a></h2>
<h3 id="added-2"><a class="header" href="#added-2">Added</a></h3>
<ul>
<li>Updates for Rust 1.59:
<ul>
<li>Support abbreviating <code>--release</code> as <code>-r</code> (<a href="https://github.com/rust-lang/cargo/pull/10133">Cargo #10133</a>).</li>
<li>Stabilize future-incompat-report (<a href="https://github.com/rust-lang/cargo/pull/10165">Cargo #10165</a>).</li>
<li>Update builtin list of targets (used by the target runner) to Rust 1.59.</li>
</ul>
</li>
</ul>
<h2 id="098---2022-02-23"><a class="header" href="#098---2022-02-23"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.8">0.9.8</a> - 2022-02-23</a></h2>
<h3 id="fixed-2"><a class="header" href="#fixed-2">Fixed</a></h3>
<ul>
<li>Target runners of the form <code>runner = [&quot;bin-name&quot;, &quot;--arg1&quot;, ...]</code> are now parsed correctly (<a href="https://github.com/nextest-rs/nextest/pull/75">#75</a>).</li>
<li>Binary IDs for <code>[[bin]]</code> and <code>[[example]]</code> tests are now unique, in the format <code>&lt;crate-name&gt;::bin/&lt;binary-name&gt;</code> and <code>&lt;crate-name&gt;::test/&lt;binary-name&gt;</code> respectively (<a href="https://github.com/nextest-rs/nextest/pull/76">#76</a>).</li>
</ul>
<h2 id="097---2022-02-23"><a class="header" href="#097---2022-02-23"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.7">0.9.7</a> - 2022-02-23</a></h2>
<h3 id="fixed-3"><a class="header" href="#fixed-3">Fixed</a></h3>
<ul>
<li>If parsing target runner configuration fails, warn and proceed without a target runner rather than erroring out.</li>
</ul>
<h3 id="known-issues"><a class="header" href="#known-issues">Known issues</a></h3>
<ul>
<li>Parsing an array of strings for the target runner currently fails: <a href="https://github.com/nextest-rs/nextest/issues/73">#73</a>. A fix is being worked on in <a href="https://github.com/nextest-rs/nextest/pull/75">#75</a>.</li>
</ul>
<h2 id="096---2022-02-22"><a class="header" href="#096---2022-02-22"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.6">0.9.6</a> - 2022-02-22</a></h2>
<h3 id="added-3"><a class="header" href="#added-3">Added</a></h3>
<ul>
<li>Support Cargo configuration for <a href="https://nexte.st/book/target-runners">target runners</a>.</li>
</ul>
<h2 id="095---2022-02-20"><a class="header" href="#095---2022-02-20"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.5">0.9.5</a> - 2022-02-20</a></h2>
<h3 id="fixed-4"><a class="header" href="#fixed-4">Fixed</a></h3>
<ul>
<li>Updated nextest-runner to 0.1.2, fixing cyan coloring of module paths (<a href="https://github.com/nextest-rs/nextest/issues/52">#52</a>).</li>
</ul>
<h2 id="094---2022-02-16"><a class="header" href="#094---2022-02-16"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.4">0.9.4</a> - 2022-02-16</a></h2>
<p>The big new change is that release binaries are now available! Head over to <a href="https://nexte.st/book/pre-built-binaries">Pre-built binaries</a> for more.</p>
<h3 id="added-4"><a class="header" href="#added-4">Added</a></h3>
<ul>
<li>In test output, module paths are now colored cyan (<a href="https://github.com/nextest-rs/nextest/pull/42">#42</a>).</li>
</ul>
<h3 id="fixed-5"><a class="header" href="#fixed-5">Fixed</a></h3>
<ul>
<li>While querying binaries to list tests, lines ending with &quot;: benchmark&quot; will now be ignored (<a href="https://github.com/nextest-rs/nextest/issues/46">#46</a>).</li>
</ul>
<h2 id="093---2022-02-14"><a class="header" href="#093---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.3">0.9.3</a> - 2022-02-14</a></h2>
<h3 id="fixed-6"><a class="header" href="#fixed-6">Fixed</a></h3>
<ul>
<li>Add a <code>BufWriter</code> around stderr for the reporter, reducing the number of syscalls and fixing
issues around output overlap on Windows (<a href="https://github.com/nextest-rs/nextest/issues/35">#35</a>). Thanks <a href="https://github.com/fdncred">@fdncred</a> for reporting this!</li>
</ul>
<h2 id="092---2022-02-14"><a class="header" href="#092---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.2">0.9.2</a> - 2022-02-14</a></h2>
<h3 id="fixed-7"><a class="header" href="#fixed-7">Fixed</a></h3>
<ul>
<li>Running cargo nextest from within a crate now runs tests for just that crate, similar to cargo
test. Thanks <a href="https://twitter.com/RealWittenstein/status/1493291441384210437">Yaron Wittenstein</a>
for reporting this!</li>
</ul>
<h2 id="091---2022-02-14"><a class="header" href="#091---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.1">0.9.1</a> - 2022-02-14</a></h2>
<h3 id="fixed-8"><a class="header" href="#fixed-8">Fixed</a></h3>
<ul>
<li>Updated nextest-runner to 0.1.1, fixing builds on Rust 1.54.</li>
</ul>
<h2 id="090---2022-02-14"><a class="header" href="#090---2022-02-14"><a href="https://github.com/nextest-rs/nextest/releases/tag/cargo-nextest-0.9.0">0.9.0</a> - 2022-02-14</a></h2>
<p><strong>Initial release.</strong> Happy Valentine's day!</p>
<h3 id="added-5"><a class="header" href="#added-5">Added</a></h3>
<p>Supported in this initial release:</p>
<ul>
<li><a href="book/listing.html">Listing tests</a></li>
<li><a href="book/running.html">Running tests in parallel</a> for faster results</li>
<li><a href="book/partitioning.html">Partitioning tests</a> across multiple CI jobs</li>
<li><a href="book/retries.html">Test retries</a> and flaky test detection</li>
<li><a href="book/junit.html">JUnit support</a> for integration with other test tooling</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
